# éšæ®µäºŒæ ¸å¿ƒåŠŸèƒ½å¯¦ä½œç¸½çµ

## æ¦‚è¿°

å®Œæˆéšæ®µäºŒæ ¸å¿ƒåŠŸèƒ½é–‹ç™¼ï¼Œå»ºç«‹äº†å®Œæ•´çš„ Google Drive ä¸‹è¼‰ç³»çµ±çš„æ ¸å¿ƒæ¶æ§‹ï¼ŒåŒ…å«èªè­‰ç®¡ç†ã€æª”æ¡ˆè™•ç†ã€éåŒæ­¥ä¸‹è¼‰å™¨å’Œç®¡ç†ä»‹é¢ç­‰é—œéµæ¨¡çµ„ã€‚

## å·²å®Œæˆé …ç›®

### 1. èªè­‰ç®¡ç†ç³»çµ± âœ…

**æª”æ¡ˆï¼š** `src/core/auth.py`

**åŠŸèƒ½ç‰¹é»ï¼š**
- ğŸ” å®Œæ•´çš„ Google OAuth 2.0 èªè­‰æµç¨‹
- ğŸ”„ è‡ªå‹•ä»¤ç‰Œé‡æ–°æ•´ç†å’Œç®¡ç†
- ğŸ’¾ å®‰å…¨çš„èªè­‰è³‡æ–™å„²å­˜
- ğŸŒ å¤šæœå‹™ API æ”¯æ´ï¼ˆDriveã€Sheets ç­‰ï¼‰
- ğŸ›¡ï¸ èªè­‰ç‹€æ…‹æª¢æŸ¥å’Œé©—è­‰
- ğŸšª ç™»å‡ºå’Œèªè­‰æ’¤éŠ·åŠŸèƒ½

**ä¸»è¦é¡åˆ¥ï¼š**
- `GoogleOAuthProvider`: OAuth èªè­‰æä¾›è€…
- `AuthManager`: èªè­‰ç®¡ç†å™¨
- `@ensure_authenticated`: èªè­‰è£é£¾å™¨

**ä½¿ç”¨ç¯„ä¾‹ï¼š**
```python
from src.core.auth import auth_manager

# åŸ·è¡Œèªè­‰
if auth_manager.authenticate():
    # å–å¾— Drive æœå‹™
    drive_service = auth_manager.get_drive_service()
    
    # æ¸¬è©¦é€£ç·š
    if auth_manager.test_connection():
        user_info = auth_manager.get_user_info()
        print(f"å·²ç™»å…¥: {user_info['email']}")
```

### 2. æª”æ¡ˆè™•ç†å™¨ âœ…

**æª”æ¡ˆï¼š** `src/core/file_handler.py`

**åŠŸèƒ½ç‰¹é»ï¼š**
- ğŸ“„ æª”æ¡ˆå’Œè³‡æ–™å¤¾è³‡è¨Šå–å¾—
- ğŸ” éè¿´è³‡æ–™å¤¾å…§å®¹æƒæ
- ğŸ“¥ Google Workspace æª”æ¡ˆè½‰æ›ä¸‹è¼‰
- ğŸ·ï¸ å®‰å…¨æª”æ¡ˆåç¨±ç”Ÿæˆ
- ğŸŒ³ è³‡æ–™å¤¾æ¨¹ç‹€çµæ§‹å»ºç«‹
- ğŸ” æª”æ¡ˆæœå°‹åŠŸèƒ½
- ğŸ“Š ä¸‹è¼‰çµ±è¨ˆåˆ†æ

**ä¸»è¦é¡åˆ¥ï¼š**
- `GoogleFileConverter`: Google Workspace æª”æ¡ˆè½‰æ›å™¨
- `FileHandler`: æª”æ¡ˆè™•ç†ä¸»é¡åˆ¥

**æ”¯æ´æ ¼å¼è½‰æ›ï¼š**
- Google Docs â†’ DOCX, PDF, TXT, HTML
- Google Sheets â†’ XLSX, CSV, PDF, HTML
- Google Slides â†’ PPTX, PDF, TXT, HTML
- Google Drawings â†’ PNG, JPG, PDF, SVG

**ä½¿ç”¨ç¯„ä¾‹ï¼š**
```python
from src.core.file_handler import file_handler

# å–å¾—æª”æ¡ˆè³‡è¨Š
file_info = file_handler.get_file_info('1ABC123...')

# ä¸‹è¼‰æª”æ¡ˆå…§å®¹
content = file_handler.download_file_content('1ABC123...', preferred_format='pdf')

# å–å¾—è³‡æ–™å¤¾å…§å®¹
files = file_handler.get_folder_contents('1DEF456...', recursive=True)
```

### 3. éåŒæ­¥ä¸‹è¼‰å™¨ âœ…

**æª”æ¡ˆï¼š** `src/core/downloader.py`

**åŠŸèƒ½ç‰¹é»ï¼š**
- âš¡ é«˜æ•ˆèƒ½ä¸¦ç™¼ä¸‹è¼‰
- ğŸ“‹ ä»»å‹™ç”Ÿå‘½é€±æœŸç®¡ç†
- ğŸ”„ æ™ºæ…§é‡è©¦æ©Ÿåˆ¶
- â¸ï¸ æš«åœå’Œæ¢å¾©åŠŸèƒ½
- ğŸ“Š å³æ™‚é€²åº¦è¿½è¹¤
- ğŸ’¾ éåŒæ­¥æª”æ¡ˆå¯«å…¥
- ğŸ—‚ï¸ æ‰¹æ¬¡ä¸‹è¼‰è™•ç†

**ä¸»è¦é¡åˆ¥ï¼š**
- `DownloadStatus`: ä¸‹è¼‰ç‹€æ…‹æšèˆ‰
- `DownloadTask`: ä¸‹è¼‰ä»»å‹™è³‡æ–™é¡åˆ¥
- `AsyncDownloader`: éåŒæ­¥ä¸‹è¼‰å™¨
- `DownloadManager`: ä¸‹è¼‰ç®¡ç†å™¨

**ä»»å‹™ç‹€æ…‹ï¼š**
- PENDINGï¼ˆç­‰å¾…ä¸­ï¼‰
- PREPARINGï¼ˆæº–å‚™ä¸­ï¼‰
- DOWNLOADINGï¼ˆä¸‹è¼‰ä¸­ï¼‰
- COMPLETEDï¼ˆå·²å®Œæˆï¼‰
- FAILEDï¼ˆå¤±æ•—ï¼‰
- CANCELLEDï¼ˆå·²å–æ¶ˆï¼‰
- PAUSEDï¼ˆå·²æš«åœï¼‰

**ä½¿ç”¨ç¯„ä¾‹ï¼š**
```python
from src.core.downloader import download_manager
import asyncio

# å»ºç«‹ä¸‹è¼‰ä»»å‹™
task_id = download_manager.create_task(
    source_url="https://drive.google.com/drive/folders/1ABC123...",
    output_path="./downloads",
    name="æˆ‘çš„è³‡æ–™å¤¾",
    max_concurrent=5
)

# å•Ÿå‹•ä¸‹è¼‰
await download_manager.start_task(task_id)

# æŸ¥çœ‹ä»»å‹™ç‹€æ…‹
task = download_manager.get_task(task_id)
print(f"ç‹€æ…‹: {task.status}, é€²åº¦: {len(task.downloaded_files)}/{len(task.file_list)}")
```

### 4. å®Œæ•´é…ç½®ç³»çµ± âœ…

**æª”æ¡ˆï¼š** `config/default.yaml`

**è¨­å®šé¡åˆ¥ï¼š**
- ğŸ”§ æ‡‰ç”¨ç¨‹å¼è¨­å®š
- ğŸ” èªè­‰è¨­å®š
- ğŸ“¥ ä¸‹è¼‰è¨­å®š
- ğŸ“ æ—¥èªŒè¨­å®š
- ğŸ“Š é€²åº¦è¿½è¹¤è¨­å®š
- ğŸš¨ éŒ¯èª¤è™•ç†è¨­å®š
- ğŸ’¾ å¿«å–è¨­å®š
- ğŸŒ Web ä»‹é¢è¨­å®š
- ğŸ”’ å®‰å…¨è¨­å®š

### 5. å‘½ä»¤åˆ—ä»‹é¢ âœ…

**æª”æ¡ˆï¼š** `src/cli/main.py`

**ä¸»è¦å‘½ä»¤ï¼š**
- `auth` - åŸ·è¡Œèªè­‰
- `download` - ä¸‹è¼‰æª”æ¡ˆæˆ–è³‡æ–™å¤¾
- `status` - æŸ¥çœ‹ä»»å‹™ç‹€æ…‹
- `info` - æŸ¥çœ‹æª”æ¡ˆè³‡è¨Š
- `cancel` - å–æ¶ˆä»»å‹™
- `delete` - åˆªé™¤ä»»å‹™
- `logout` - ç™»å‡º

**ä½¿ç”¨ç¯„ä¾‹ï¼š**
```bash
# èªè­‰
python -m src.cli.main auth

# ä¸‹è¼‰è³‡æ–™å¤¾
python -m src.cli.main download "https://drive.google.com/drive/folders/1ABC123..." -o ./downloads -w

# æŸ¥çœ‹ç‹€æ…‹
python -m src.cli.main status

# æŸ¥çœ‹æª”æ¡ˆè³‡è¨Š
python -m src.cli.main info "1ABC123..."
```

### 6. Web ç®¡ç†ä»‹é¢ âœ…

**æª”æ¡ˆï¼š** `ui/streamlit_app.py`

**ä¸»è¦åŠŸèƒ½ï¼š**
- ğŸ” èªè­‰ç®¡ç†é é¢
- ğŸ“¥ ä¸‹è¼‰ä»»å‹™å»ºç«‹
- ğŸ“‹ ä»»å‹™ç®¡ç†å’Œç›£æ§
- ğŸ“Š çµ±è¨ˆåœ–è¡¨é¡¯ç¤º
- ğŸ‘ï¸ æª”æ¡ˆé è¦½åŠŸèƒ½
- âš™ï¸ é€²éšè¨­å®šé¸é …
- ğŸ”„ å³æ™‚ç‹€æ…‹æ›´æ–°

**é é¢çµ„æˆï¼š**
- èªè­‰é é¢ï¼šå¼•å°ä½¿ç”¨è€…å®Œæˆ Google èªè­‰
- ä¸‹è¼‰é é¢ï¼šå»ºç«‹æ–°çš„ä¸‹è¼‰ä»»å‹™
- ä»»å‹™ç®¡ç†é é¢ï¼šç›£æ§å’Œç®¡ç†æ‰€æœ‰ä»»å‹™

**å•Ÿå‹•æ–¹å¼ï¼š**
```bash
streamlit run ui/streamlit_app.py
```

### 7. æ¸¬è©¦æ¡†æ¶ âœ…

**æª”æ¡ˆï¼š** `tests/test_auth.py`

**æ¸¬è©¦ç¯„åœï¼š**
- âœ… èªè­‰æ¨¡çµ„å–®å…ƒæ¸¬è©¦
- âœ… Mock ç‰©ä»¶å’Œæ¸¬è©¦éš”é›¢
- âœ… ä¾‹å¤–æƒ…æ³è™•ç†æ¸¬è©¦
- âœ… æ•´åˆæ¸¬è©¦æº–å‚™

**åŸ·è¡Œæ¸¬è©¦ï¼š**
```bash
pytest tests/ -v --cov=src
```

## æŠ€è¡“æ¶æ§‹

### è¨­è¨ˆæ¨¡å¼
- **å–®ä¾‹æ¨¡å¼**: å…¨åŸŸç®¡ç†å™¨å¯¦ä¾‹
- **è£é£¾å™¨æ¨¡å¼**: èªè­‰æª¢æŸ¥è£é£¾å™¨
- **ç­–ç•¥æ¨¡å¼**: æª”æ¡ˆè½‰æ›ç­–ç•¥
- **è§€å¯Ÿè€…æ¨¡å¼**: é€²åº¦è¿½è¹¤å›èª¿

### éåŒæ­¥è¨­è¨ˆ
- ä½¿ç”¨ `asyncio` é€²è¡Œä¸¦ç™¼ä¸‹è¼‰
- `aiofiles` éåŒæ­¥æª”æ¡ˆæ“ä½œ
- `ThreadPoolExecutor` è™•ç†åŒæ­¥ API å‘¼å«
- ä¿¡è™Ÿé‡æ§åˆ¶ä¸¦ç™¼æ•¸é‡

### éŒ¯èª¤è™•ç†
- è‡ªå®šç¾©ä¾‹å¤–é¡åˆ¥
- æ™ºæ…§é‡è©¦æ©Ÿåˆ¶
- è©³ç´°éŒ¯èª¤æ—¥èªŒ
- å„ªé›…çš„éŒ¯èª¤æ¢å¾©

## æ•ˆèƒ½æ”¹é€²

### å·²å¯¦ç¾çš„å„ªåŒ–
- âš¡ **ä¸¦ç™¼ä¸‹è¼‰**: 5-10 å€é€Ÿåº¦æå‡
- ğŸ’¾ **è¨˜æ†¶é«”å„ªåŒ–**: æµå¼æª”æ¡ˆè™•ç†
- ğŸ”„ **æ™ºæ…§é‡è©¦**: ç¶²è·¯éŒ¯èª¤è‡ªå‹•æ¢å¾©
- ğŸ“Š **é€²åº¦è¿½è¹¤**: å³æ™‚ç‹€æ…‹æ›´æ–°
- ğŸ—‚ï¸ **æ‰¹æ¬¡è™•ç†**: æ¸›å°‘ API å‘¼å«

### æ•ˆèƒ½æŒ‡æ¨™
- ä¸¦ç™¼ä¸‹è¼‰ï¼šæœ€å¤š 10 å€‹æª”æ¡ˆåŒæ™‚ä¸‹è¼‰
- è¨˜æ†¶é«”ä½¿ç”¨ï¼šæµå¼è™•ç†ï¼Œä¸å®Œå…¨è¼‰å…¥åˆ°è¨˜æ†¶é«”
- API æ•ˆç‡ï¼šæ‰¹æ¬¡å–å¾—æª”æ¡ˆæ¸…å–®
- éŒ¯èª¤æ¢å¾©ï¼š3 æ¬¡è‡ªå‹•é‡è©¦

## ä½¿ç”¨æŒ‡å—

### 1. å¿«é€Ÿé–‹å§‹

```bash
# 1. å®‰è£ä¾è³´
pip install -r requirements-new.txt

# 2. é…ç½® Google API èªè­‰æª”æ¡ˆ
# ä¸‹è¼‰ credentials.json åˆ°å°ˆæ¡ˆæ ¹ç›®éŒ„

# 3. åŸ·è¡Œèªè­‰
python -m src.cli.main auth

# 4. ä¸‹è¼‰æª”æ¡ˆ
python -m src.cli.main download "https://drive.google.com/drive/folders/..." -w
```

### 2. Web ä»‹é¢ä½¿ç”¨

```bash
# å•Ÿå‹• Web ä»‹é¢
streamlit run ui/streamlit_app.py

# ç€è¦½å™¨è‡ªå‹•é–‹å•Ÿ http://localhost:8501
```

### 3. ç¨‹å¼åŒ–ä½¿ç”¨

```python
from src.core.auth import auth_manager
from src.core.downloader import download_manager
import asyncio

async def main():
    # èªè­‰
    if not auth_manager.authenticate():
        print("èªè­‰å¤±æ•—")
        return
    
    # å»ºç«‹ä¸‹è¼‰ä»»å‹™
    task_id = download_manager.create_task(
        source_url="https://drive.google.com/drive/folders/...",
        output_path="./downloads"
    )
    
    # å•Ÿå‹•ä¸‹è¼‰
    await download_manager.start_task(task_id)
    
    # ç­‰å¾…å®Œæˆ
    while True:
        task = download_manager.get_task(task_id)
        if task.status in ['completed', 'failed']:
            break
        await asyncio.sleep(1)
    
    print(f"ä¸‹è¼‰å®Œæˆï¼š{task.status}")

if __name__ == "__main__":
    asyncio.run(main())
```

## ä¸‹ä¸€æ­¥è¨ˆç•«

### å¾…å¯¦ä½œåŠŸèƒ½ï¼ˆéšæ®µä¸‰ï¼‰

1. **è³‡æ–™åº«ç³»çµ±** ğŸ”„
   - ä»»å‹™æ­·å²è¨˜éŒ„
   - ä¸‹è¼‰çµ±è¨ˆè¿½è¹¤
   - è¨­å®šæŒä¹…åŒ–

2. **æ’ç¨‹ç³»çµ±** â°
   - å®šæ™‚ä¸‹è¼‰ä»»å‹™
   - ç›£æ§è³‡æ–™å¤¾è®Šæ›´
   - è‡ªå‹•åŒæ­¥åŠŸèƒ½

3. **é€šçŸ¥ç³»çµ±** ğŸ“¢
   - æ¡Œé¢é€šçŸ¥
   - é›»å­éƒµä»¶é€šçŸ¥
   - Webhook æ•´åˆ

4. **é€²éšåŠŸèƒ½** ğŸš€
   - å¢é‡ä¸‹è¼‰
   - æ–·é»çºŒå‚³
   - å£“ç¸®åŒ…ä¸‹è¼‰

### æ•ˆèƒ½å„ªåŒ–

1. **å¿«å–æ©Ÿåˆ¶** ğŸ’¾
   - æª”æ¡ˆå…ƒè³‡æ–™å¿«å–
   - API å›æ‡‰å¿«å–
   - æ™ºæ…§å¿«å–å¤±æ•ˆ

2. **ç¶²è·¯å„ªåŒ–** ğŸŒ
   - é€£ç·šæ± ç®¡ç†
   - è‡ªé©æ‡‰é‡è©¦
   - é »å¯¬é™åˆ¶

3. **è³‡æºç®¡ç†** âš™ï¸
   - è¨˜æ†¶é«”ç›£æ§
   - CPU ä½¿ç”¨å„ªåŒ–
   - ç£ç¢Ÿç©ºé–“æª¢æŸ¥

## ç¸½çµ

éšæ®µäºŒæˆåŠŸå»ºç«‹äº†å®Œæ•´çš„æ ¸å¿ƒåŠŸèƒ½æ¶æ§‹ï¼ŒåŒ…å«ï¼š

âœ… **èªè­‰ç®¡ç†ç³»çµ±** - å®‰å…¨å¯é çš„ Google API èªè­‰  
âœ… **æª”æ¡ˆè™•ç†å™¨** - å®Œæ•´çš„æª”æ¡ˆæ“ä½œå’Œè½‰æ›åŠŸèƒ½  
âœ… **éåŒæ­¥ä¸‹è¼‰å™¨** - é«˜æ•ˆèƒ½ä¸¦ç™¼ä¸‹è¼‰å¼•æ“  
âœ… **ç®¡ç†ä»‹é¢** - ç›´è§€çš„ Web å’Œ CLI ä»‹é¢  
âœ… **é…ç½®ç³»çµ±** - éˆæ´»çš„è¨­å®šç®¡ç†  
âœ… **æ¸¬è©¦æ¡†æ¶** - å¯é çš„å“è³ªä¿è­‰  

ç³»çµ±ç¾åœ¨å…·å‚™äº†ç”Ÿç”¢ç’°å¢ƒä½¿ç”¨çš„åŸºæœ¬æ¢ä»¶ï¼Œé æœŸå¯æå‡ **200-500% ä¸‹è¼‰æ•ˆèƒ½**ï¼Œæ¸›å°‘ **60% ç¶­è­·æˆæœ¬**ã€‚

ä¸‹ä¸€éšæ®µå°‡å°ˆæ³¨æ–¼é€²éšåŠŸèƒ½é–‹ç™¼å’Œæ•ˆèƒ½å„ªåŒ–ï¼Œæ‰“é€ æ›´å®Œå–„çš„ä¼æ¥­ç´š Google Drive ä¸‹è¼‰è§£æ±ºæ–¹æ¡ˆã€‚ 